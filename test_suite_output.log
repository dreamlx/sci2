InheritedResources loaded: 
Run options: exclude {performance_benchmark: true}

Commands::AssignReimbursementCommand
  #initialize
    initializes with default values
    initializes with provided values
  #call
    with valid inputs
      successfully assigns reimbursement
      creates assignment with correct attributes
    with invalid inputs
      fails when reimbursement_id is nil
      fails when assignee_id is nil
      fails when current_user is nil
      fails when reimbursement does not exist
      fails when assignee does not exist
    when assignment service fails
      returns failure result
    when unexpected error occurs
      returns failure result with error message
  ActiveModel validations
    validates presence of reimbursement_id
    validates presence of assignee_id
    validates presence of current_user

Commands::ResetReimbursementOverrideCommand
  #initialize
    initializes with default values
    initializes with provided values
  #call
    with valid inputs
      successfully resets manual override
      removes manual override from reimbursement
    with invalid inputs
      fails when reimbursement_id is nil
      fails when current_user is nil
      fails when reimbursement does not exist
    when override service fails
      returns failure result
    when unexpected error occurs
      returns failure result with error message
  ActiveModel validations
    validates presence of reimbursement_id
    validates presence of current_user

Commands::SetReimbursementStatusCommand
  #initialize
    initializes with default values
    initializes with provided values
  #call
    with valid inputs
      successfully sets reimbursement status
      updates reimbursement status
    with invalid inputs
      fails when reimbursement_id is nil
      fails when status is nil
      fails when current_user is nil
      fails when reimbursement does not exist
    when status service fails
      returns failure result
    when unexpected error occurs
      returns failure result with error message
  ActiveModel validations
    validates presence of reimbursement_id
    validates presence of status
    validates presence of current_user

WorkOrderProblemCommand
  #initialize
    initializes with valid attributes
    accepts optional attributes (FAILED - 1)
  #call
    with valid attributes
      creates a work order problem successfully (FAILED - 2)
      returns success message (FAILED - 3)
    with invalid work order
      returns failure with work order error (FAILED - 4)
    with invalid problem type
      returns failure with problem type error (FAILED - 5)
    with missing description
      returns failure with description error (FAILED - 6)
    with invalid severity
      returns failure with severity error (FAILED - 7)
    with invalid admin user
      returns failure with admin user error (FAILED - 8)
    when work order is closed
      returns failure with closed status error (FAILED - 9)
    when database save fails
      returns failure with database error (FAILED - 10)
  #valid_severities
    returns array of valid severities (FAILED - 11)
  #validate_work_order
    returns true for valid work order (FAILED - 12)
    returns false for non-existent work order (FAILED - 13)
    returns false for nil work order id (FAILED - 14)
  #validate_problem_type
    returns true for valid problem type (FAILED - 15)
    returns false for non-existent problem type (FAILED - 16)
    returns false for nil problem type id (FAILED - 17)
  #validate_admin_user
    returns true for valid admin user (FAILED - 18)
    returns false for non-existent admin user (FAILED - 19)
    returns false for nil admin user id (FAILED - 20)
  #validate_description
    returns true for valid description (FAILED - 21)
    returns false for empty description (FAILED - 22)
    returns false for nil description (FAILED - 23)
    returns false for description that is too short (FAILED - 24)
  #validate_severity
    returns true for valid severities (FAILED - 25)
    returns false for invalid severity (FAILED - 26)
    returns false for nil severity (FAILED - 27)
  #validate_work_order_status
    returns true for open work order (FAILED - 28)
    returns false for closed work order (FAILED - 29)
    returns false for cancelled work order (FAILED - 30)
  error handling
    handles validation errors gracefully (FAILED - 31)
    handles unexpected errors gracefully (FAILED - 32)
  integration with work order status
    updates work order status when critical problem is added (FAILED - 33)
    does not change work order status for low severity problems (FAILED - 34)

Admin::BaseController
  class configuration
    inherits from ApplicationController
    uses active_admin layout
    has authenticate_admin_user! before_action
  protected methods
    #current_admin_user
      delegates to current_user from ApplicationController

Admin::ProblemTypeQueriesController
  GET #for_fee_details
    with valid parameters
      returns problem types as JSON
      includes expected attributes in response
      accepts multiple fee detail IDs
    with missing reimbursement_id
      returns bad request error
    with missing fee_detail_ids
      returns bad request error
    with invalid reimbursement_id
      returns bad request error
    when not authenticated
      redirects to sign in

Admin::ReimbursementsController (Temporarily Disabled)
  should be rewritten as ActiveAdmin controller test (PENDING: This test needs to be rewritten as an ActiveAdmin controller test using proper ActiveAdmin test patterns)

Admin::Reimbursements Authorization
  GET /admin/reimbursements
    with admin user
      allows access to index
    with super admin user
      allows access to index
  POST /admin/reimbursements
    with admin user
      allows creation
    with super admin user
      allows creation
  PUT /admin/reimbursements/:id/assign
    with admin user
      denies assignment (FAILED - 35)
    with super admin user
      allows assignment (FAILED - 36)
  POST /admin/reimbursements/import
    with admin user
      denies import (FAILED - 37)
    with super admin user
      allows import (FAILED - 38)
  batch actions
    with admin user
      denies batch assignment (FAILED - 39)
    with super admin user
      allows batch assignment (FAILED - 40)
  manual override actions
    with admin user
      denies manual status changes (FAILED - 41)
    with super admin user
      allows manual status changes (FAILED - 42)

Admin::Users Authorization
  GET /admin/admin_users
    with admin user
      denies access to admin users list (FAILED - 43)
    with super admin user
      allows access to admin users list (FAILED - 44)
  POST /admin/admin_users
    with admin user
      denies user creation (FAILED - 45)
    with super admin user
      allows user creation (FAILED - 46)
  PUT /admin/admin_users/:id/soft_delete
    with admin user
      denies soft delete (FAILED - 47)
    with super admin user
      allows soft delete (FAILED - 48)
  batch actions
    with admin user
      denies batch soft delete (FAILED - 49)
    with super admin user
      allows batch soft delete (FAILED - 50)
  self-update permissions
    when admin user updates their own profile
      allows updating own basic info (FAILED - 51)
      prevents updating own role (FAILED - 52)

ApplicationController
  #set_locale
    sets locale to zh-CN
    is called before action
  #access_denied
    redirects to admin dashboard
    sets alert message
  #redirect_to_admin
    redirects to admin root path
  #current_user
    when admin user is authenticated
      returns current_admin_user
    when no user is authenticated
      returns nil
  #current_admin_user
    when admin user is authenticated
      returns authenticated admin user
      caches the result
  #authenticate_admin_user!
    when admin user is not authenticated
      calls redirect_to with new_admin_user_session_path
    when admin user is authenticated
      does not call redirect_to
  inheritance
    inherits from ActionController::Base

AuthorizationConcern
  authentication checks
    when user is not authenticated
      redirects to login for HTML requests
      returns 401 for JSON requests
  authorization checks with ReimbursementPolicy
    with admin user
      allows actions that admin user can perform
      denies actions that admin user cannot perform (FAILED - 53)
    with super admin user
      allows all actions for super admin
  logging functionality
    logs successful authorization (FAILED - 54)
    logs authorization failures (FAILED - 55)
  helper methods
    #require_super_admin!
      allows super admin users
      denies admin users (FAILED - 56)
    #require_admin_or_super_admin!
      allows super admin users
      allows admin users
    #require_permission?
      returns true when permission is granted
      returns false when permission is denied
  sensitive operation logging
    logs sensitive operation attempts
  parameter sanitization for logging
    filters sensitive parameters (FAILED - 57)

Admin::Imports Authorization
  GET /admin/imports
    with admin user
      denies access to imports page (FAILED - 58)
    with super admin user
      allows access to imports page
  GET /admin/imports/operation_histories
    with admin user
"导入报销单"
"导入费用明细"
"导入快递收单"
"导入操作历史"
"分配报销单"
"查看分配给我的报销单"
      denies access to operation histories (FAILED - 59)
    with super admin user
      allows access to operation histories
  POST /admin/imports/import_operation_histories
    with admin user
      denies operation history import (FAILED - 60)
    with super admin user
      allows operation history import (FAILED - 61)
  GET /admin/imports/new
    with admin user
"导入报销单"
"导入费用明细"
"导入快递收单"
"导入操作历史"
"分配报销单"
"查看分配给我的报销单"
      denies access to new import page (FAILED - 62)
    with super admin user
      allows access to new import page
  POST /admin/imports/import_problem_codes
    with admin user
      denies problem codes import (FAILED - 63)
    with super admin user
      allows problem codes import (FAILED - 64)
  JSON API access
    with admin user
      returns 403 for JSON requests (FAILED - 65)
    with super admin user
      allows JSON requests (FAILED - 66)

审核工单页面逻辑
  费用明细选择

⚠️  Slow test detected: 审核工单页面逻辑 费用明细选择 选择费用明细后显示费用类型标签 (5.56s)
    选择费用明细后显示费用类型标签 (FAILED - 67)
    选择多个费用明细时按费用类型分组显示 (FAILED - 68)
  处理意见与问题类型显示逻辑
    处理意见为'可以通过'
      显示费用类型标签但不显示问题类型选择区域 (FAILED - 69)
    处理意见为'无法通过'
      显示费用类型标签和相关问题类型选择区域 (FAILED - 70)
      选择多个费用类型时显示所有相关问题类型 (FAILED - 71)
    其他处理意见
      不显示费用类型标签和问题类型选择区域 (FAILED - 72)
  表单验证逻辑
    处理意见为'可以通过'
      必须选择至少一个费用明细 (FAILED - 73)
      不需要选择问题类型 (FAILED - 74)
    处理意见为'无法通过'
      必须选择至少一个费用明细 (FAILED - 75)
      必须选择至少一个问题类型 (FAILED - 76)
      选择问题类型后可以成功创建 (FAILED - 77)
  费用明细状态变化

⚠️  Slow test detected: 审核工单页面逻辑 费用明细状态变化 创建通过的审核工单后费用明细状态变为verified (572.7s)
    创建通过的审核工单后费用明细状态变为verified (FAILED - 78)
    创建拒绝的审核工单后费用明细状态变为problematic (FAILED - 79)
    最新工单决定费用明细状态 (FAILED - 80)

审核工单管理
  列表页
    显示所有审核工单
    可以按状态筛选
  详情页
    显示审核工单详细信息
    显示开始处理按钮 (FAILED - 81)
  创建审核工单
    可以创建新审核工单 (FAILED - 82)
  工单状态流转
    可以开始处理工单 (FAILED - 83)
    可以直接审核通过工单 (FAILED - 84)
    可以审核通过工单 (FAILED - 85)
    可以审核拒绝工单 (FAILED - 86)
  费用明细验证
    可以更新费用明细验证状态 (FAILED - 87)

沟通工单管理
  列表页
    显示所有沟通工单
    可以按状态筛选 (FAILED - 88)
  详情页
    显示沟通工单详细信息 (FAILED - 89)
    显示状态操作按钮 (FAILED - 90)
  创建沟通工单
    可以创建新沟通工单 (FAILED - 91)
  工单状态流转
    可以开始处理工单 (FAILED - 92)
