# 工单系统测试计划 (V4.1)

## 目录

- [1. 测试目标与范围](#1-测试目标与范围)
- [2. 测试环境](#2-测试环境)
- [3. 测试数据准备](#3-测试数据准备)
- [4. 测试用例分类](#4-测试用例分类)
- [5. 数据导入测试](#5-数据导入测试)
- [6. 工单处理与报销单状态联动测试](#6-工单处理与报销单状态联动测试)
- [7. 工单关联关系测试](#7-工单关联关系测试)
- [8. 费用明细验证测试](#8-费用明细验证测试)
- [9. 集成测试场景](#9-集成测试场景)
- [10. 测试执行计划](#10-测试执行计划)
- [11. 测试报告模板](#11-测试报告模板)

## 1. 测试目标与范围

### 测试目标

1. 验证工单系统的核心功能是否按照设计规范正常工作
2. 确保数据导入功能能够正确处理各类CSV/Excel文件
3. 测试工单与报销单的关联关系是否正确建立和维护
4. 确保费用明细验证功能正常工作并与工单状态正确联动
5. 测试系统在各种边界条件和异常情况下的行为
6. 验证报销单状态 (pending, processing, close) 的正确流转逻辑
7. 验证报销单进入 close 状态后，工单不可创建和修改

### 测试范围

- **数据导入模块**：报销单、快递收单、操作历史、费用明细的导入功能
- **工单处理模块**：三种工单类型（快递收单工单、审核工单、沟通工单）的创建与处理。审核工单与沟通工单逻辑一致。
- **费用明细模块**：费用明细的选择、关联和验证状态更新
- **工单关联模块**：工单与报销单的关联关系建立和追踪
- **报销单状态管理模块**：报销单状态 (pending, processing, close) 的变更及相关操作限制
## 2. 测试环境

### 开发环境

- **操作系统**：macOS/Linux/Windows
- **数据库**：PostgreSQL 13+
- **Ruby版本**：3.0+
- **Rails版本**：7.0+
- **浏览器**：Chrome 最新版、Firefox 最新版、Safari 最新版

### 测试环境

- **测试数据库**：与开发环境隔离的独立测试数据库
- **测试框架**：Rails内置测试框架（Minitest）
- **测试类型**：单元测试、集成测试、系统测试
- **CI/CD**：GitHub Actions 或 Jenkins

## 3. 测试数据准备

### 基础测试数据

1. **报销单数据**：
   - 普通报销单（非电子发票）
   - 电子发票报销单
   - 不同状态的报销单（pending、processing、close）

2. **快递收单数据**：
   - 匹配已有报销单的快递收单
   - 未匹配报销单的快递收单
   - 多次收单的情况（一个报销单对应多个快递单）

3. **费用明细数据**：
   - 不同类型的费用明细（交通费、餐费、办公用品等）
   - 不同验证状态的费用明细（pending、problematic、verified）
   - 关联多个工单的费用明细
   - 部分verified、部分problematic的混合状态费用明细集

4. **操作历史数据**：
   - 不同操作类型的历史记录（审批、审批通过、退回等）
   - 不同操作人的历史记录
### 测试文件准备

1. **CSV测试文件**：
   - 标准格式的CSV文件
   - 包含中文字符的CSV文件
   - 格式错误的CSV文件（用于测试错误处理）
   - 包含重复数据的CSV文件（用于测试重复处理）
   - 包含部分重复部分新增的混合CSV文件

2. **Excel测试文件**：这里由客户人工测试，我们先不用考虑
   - .xlsx格式文件
   - .xls格式文件
   - 包含多个工作表的Excel文件

3. **测试数据生成脚本**：
   - 开发自动化脚本生成大量测试数据
   - 支持生成不同场景的测试数据集
   - 生成直接approved状态工单的测试数据

## 4. 测试用例分类

### 按功能模块分类

1. **数据导入测试**
2. **工单创建与处理测试**
3. **费用明细验证测试**
4. **工单关联关系测试**
5. **报销单状态管理测试**
6. **表单结构与字段测试**
7. **用户权限分组测试**

### 按测试类型分类

1. **单元测试**：测试各个模型和方法的独立功能
## 5. 数据导入测试

NOTICE 第一阶段： 只测试csv数据导入，不做excel处理， 是否是电子发票这个状态需要另外操作，目前只需要确认有这个字段存在。

### 5.1 报销单导入测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| IMP-R-001 | 导入标准CSV格式报销单 | 1. 准备标准格式的报销单CSV文件<br>2. 使用导入功能上传文件 | 1. 成功导入所有记录<br>2. 显示导入成功消息<br>3. 数据库中创建对应的报销单记录<br>4. 报销单状态设置为pending | 高 |
| IMP-R-002 | 导入Excel格式报销单 | 1. 准备.xlsx格式的报销单文件<br>2. 使用导入功能上传文件 | 1. 成功导入所有记录<br>2. 显示导入成功消息<br>3. 数据库中创建对应的报销单记录<br>4. 报销单状态设置为pending | 高 |
| IMP-R-003 | 导入报销单后手动设置电子发票标志 | 1. 导入报销单文件<br>2. 导入成功后，在报销单详情页找到电子发票标志选项<br>3. 手动勾选电子发票标志并保存 | 1. 成功导入所有记录<br>2. 电子发票标记字段可以被手动设置<br>3. 标记保存后正确显示在界面上 | 中 |
| IMP-R-005 | 导入格式错误的报销单文件 | 1. 准备格式错误的报销单文件<br>2. 使用导入功能上传文件 | 1. 显示导入错误消息<br>2. 提供错误详情<br>3. 不导入任何记录 | 中 |
| IMP-R-006 | 导入重复的报销单 | 1. 导入一批报销单<br>2. 再次导入相同invoice number的报销单<br>3. 测试不同字段更新时的覆盖规则 | 1. 系统识别重复记录（以invoice number作为唯一识别key）<br>2. 更新已存在的报销单记录<br>3. 显示更新成功消息<br>4. 验证更新后的完整数据对比 | 高 |
2. **集成测试**：测试多个组件之间的交互
3. **系统测试**：测试完整的业务流程
   - 重复的历史记录（用于测试重复检测）
### 5.2 快递收单导入测试

NOTICE 第一阶段： 只测试csv数据导入，不做excel处理，

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| IMP-E-001 | 导入匹配已有报销单的快递收单 | 1. 先导入报销单<br>2. 导入对应的快递收单 | 1. 成功导入所有记录<br>2. 自动关联到对应的报销单<br>3. 自动创建快递收单工单<br>4. 工单状态设为completed<br>5. 工单操作人设为导入用户 | 高 |
| IMP-E-002 | 导入未匹配报销单的快递收单 | 1. 导入不存在对应报销单的快递收单 | 1. 显示未匹配警告<br/>2. 记录未匹配的快递收单<br/>3. 提供未匹配记录下载 | 高 |
| IMP-E-004 | 导入多次收单的情况 | 1. 先导入一个报销单<br>2. 导入对应的第一个快递收单<br>3. 导入对应的第二个快递收单 | 1. 成功导入所有记录<br>2. 两个快递收单都关联到同一个报销单<br>3. 创建两个独立的快递收单工单<br>4. 两个工单状态都设为completed | 中 |
| IMP-E-005 | 导入格式错误的快递收单文件 | 1. 准备格式错误的快递收单文件<br>2. 使用导入功能上传文件 | 1. 显示导入错误消息<br>2. 提供错误详情<br>3. 不导入任何记录 | 中 |
### 5.3 费用明细导入测试

NOTICE 第一阶段： 只测试csv数据导入，不做excel处理，

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| IMP-F-001 | 导入匹配已有报销单的费用明细 | 1. 先导入报销单<br>2. 导入对应的费用明细 | 1. 成功导入所有记录<br>2. 自动关联到对应的报销单<br>3. 设置费用明细验证状态为pending | 高 |
| IMP-F-002 | 导入未匹配报销单的费用明细 | 1. 导入不存在对应报销单的费用明细 | 1. 显示未匹配警告<br>2. 提供未匹配成功的items csv下载 | 中 |
| IMP-F-004 | 导入多种费用类型的明细 | 1. 准备包含多种费用类型的明细文件<br>2. 使用导入功能上传文件 | 1. 成功导入所有记录<br>2. 正确识别不同的费用类型<br>3. 设置费用明细验证状态为pending | 中 |
| IMP-F-005 | 导入格式错误的费用明细文件 | 1. 准备格式错误的费用明细文件<br>2. 使用导入功能上传文件 | 1. 显示导入错误消息<br>2. 提供错误详情<br>3. 不导入任何记录 | 中 |
| IMP-F-006 | 导入重复的费用明细 | 1. 导入一批费用明细<br>2. 再次导入完全相同的费用明细<br>3. 导入部分重复部分新增的混合数据 | 1. 系统识别重复记录<br>2. 跳过重复记录<br>3. 显示跳过记录数量<br>4. 验证重复记录的精确识别<br>5. 验证部分重复部分新增的混合场景处理正确 | 高 |
### 5.4 操作历史导入测试

NOTICE 第一阶段： 只测试csv数据导入，不做excel处理，

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| IMP-O-001 | 导入匹配已有报销单的操作历史 | 1. 先导入报销单<br>2. 导入对应的操作历史 | 1. 成功导入所有记录<br>2. 自动关联到对应的报销单 | 高 |
| IMP-O-002 | 导入审批通过类型的操作历史 | 1. 先导入报销单<br>2. 导入包含"审批通过"类型的操作历史：<br />{操作类型：审批,操作意见：审批通过} | 1. 成功导入记录<br>2. 自动更新报销单状态为 `close` | 高 |
| IMP-O-004 | 导入未匹配报销单的操作历史 | 1. 导入不存在对应报销单的操作历史 | 1. 显示未匹配警告<br/>2. 提供未匹配成功的items csv下载 | 中 |
| IMP-O-005 | 导入格式错误的操作历史文件 | 1. 准备格式错误的操作历史文件<br>2. 使用导入功能上传文件 | 1. 显示导入错误消息<br>2. 提供错误详情<br>3. 不导入任何记录 | 中 |
| IMP-O-006 | 导入重复的操作历史 | 1. 导入一批操作历史<br>2. 再次导入完全相同的操作历史<br>3. 导入部分重复部分新增的混合数据 | 1. 系统识别重复记录<br>2. 跳过重复记录<br>3. 显示跳过记录数量<br>4. 验证重复记录的精确识别<br>5. 验证导入完成后的重复记录统计信息显示<br>6. 验证部分重复部分新增的混合场景处理正确 | 高 |
### 5.5 导入顺序测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| IMP-S-001 | 按正确顺序导入所有数据 | 1. 先导入报销单<br>2. 导入快递收单<br>3. 导入费用明细<br>4. 导入操作历史 | 1. 所有数据成功导入<br>2. 所有关联关系正确建立<br>3. 工单自动创建<br>4. 状态正确更新 | 高 |
| IMP-S-002 | 颠倒顺序导入数据 | 1. 先导入操作历史<br>2. 导入费用明细<br>3. 导入快递收单<br>4. 导入报销单 | 1. 系统能够处理顺序错误<br>2. 跳过未匹配item<br>3. 最终所有关联关系正确 | 中 |
| IMP-S-003 | 混合顺序多次导入 | 1. 先导入部分报销单<br>2. 导入部分快递收单<br>3. 再导入剩余报销单<br>4. 导入费用明细和操作历史 | 1. 系统能够正确处理混合顺序<br>2. 最终所有关联关系正确<br>3. 工单状态正确 | 中 |
## 6. 工单处理与报销单状态联动测试

### 6.1 快递收单工单测试

快递收单工单在导入时自动创建并设置为已完成状态。

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| WF-E-001 | 快递收单工单自动创建 | 1. 导入快递收单数据 | 1. 自动创建快递收单工单<br>2. 收单工单状态设置为completed<br>3. 工单操作人设置为导入用户<br>4. 关联报销单状态变为 processing (如果之前是 pending) | 高 |
| WF-E-002 | 快递收单工单关联报销单 | 1. 导入报销单<br>2. 导入对应的快递收单 | 1. 快递收单工单自动关联到报销单 | 高 |

### 6.2 审核与沟通工单处理测试

审核工单与沟通工单逻辑一致，在报销单 show 页面创建。创建任一此类工单会使报销单状态变为 `processing` (如果之前是 `pending`)。工单没有状态变更历史记录。

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| WF-AC-001 | 审核/沟通工单创建与基础处理 - 通过路径 | 1. 在报销单show页面创建审核/沟通工单<br>2. 选择费用明细<br>3. 填写必要信息（问题类型、说明、备注等）<br>4. 处理意见：审核通过（工单标记为 approved） | 1. 工单成功创建并标记为 approved<br>2. 关联报销单状态变为 processing (如果之前是 pending)<br>3. 关联费用明细状态变为 verified | 高 |
| WF-AC-002 | 审核/沟通工单创建与基础处理 - 不通过路径 | 1. 在报销单show页面创建审核/沟通工单<br>2. 选择费用明细<br>3. 填写必要信息（问题类型、说明、备注等）<br>4. 处理意见：审核不通过（工单标记为 rejected） | 1. 工单成功创建并标记为 rejected<br>2. 关联报销单状态变为 processing (如果之前是 pending)<br>3. 关联费用明细状态变为 problematic | 高 |
| WF-AC-003 | 审核/沟通工单处理中保存（无明确通过/不通过意见） | 1. 在报销单show页面创建审核/沟通工单<br>2. 选择费用明细<br>3. 填写部分信息（问题类型、说明、备注等）<br>4. 保存工单（无明确 approved/rejected 意见） | 1. 工单成功创建/更新<br>2. 关联报销单状态变为 processing (如果之前是 pending)<br>3. 关联费用明细状态变为 problematic (如果工单包含问题指向) | 中 |
| WF-AC-004 | 审核/沟通工单必填字段验证（费用明细） | 1. 在报销单show页面创建审核/沟通工单<br>2. 不选择费用明细<br>3. 尝试提交/保存 | 1. 系统显示错误消息<br>2. 要求选择至少一条费用明细 | 高 |
| WF-AC-005 | 审核/沟通工单问题类型必填验证（不通过时） | 1. 在报销单show页面创建审核/沟通工单<br>2. 选择费用明细<br>3. 处理意见：审核不通过<br>4. 不选择问题类型<br>5. 尝试提交/保存 | 1. 系统显示错误消息<br>2. 要求选择问题类型 | 高 |
|           |                                                  |                                                              |                                                              |        |
|           |                                                  |                                                              |                                                              |        |

### 6.3 工单表单字段测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| WF-FORM-001 | 工单表单字段完整性验证 | 1. 分别创建审核工单和沟通工单<br>2. 验证表单包含：费用明细选择、问题类型下拉列表、问题说明下拉列表、备注说明text、处理意见下拉列表<br>3. 验证操作人默认为当前用户 | 1. 两种工单表单结构<br />2. 所有必填字段都存在且正常工作<br>3. 操作人自动填充为当前用户 | 高 |

### 6.4 报销单关闭 (close) 状态测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| WF-CL-001 | 报销单状态变为 processing | 1. 创建报销单 (初始状态 pending)<br>2. 创建任意类型工单 (快递收单/审核/沟通) | 1. 报销单状态从 pending 变为 processing | 高 |
| WF-CL-002 | 报销单状态从 processing 变为 close | 1. 报销单状态为 processing<br>2. 用户点击"处理完成"按钮 | 1. 报销单状态变为 close | 高 |
| WF-CL-003 | close状态下禁止创建新工单 | 1. 报销单状态为 close<br>2. 尝试创建新的审核工单<br>3. 尝试创建新的沟通工单 | 1. 系统阻止创建新工单<br>2. 显示提示信息 | 高 |
| WF-CL-004 | close状态下禁止修改现有工单 | 1. 报销单状态为 close，已有关联工单<br>2. 尝试修改现有审核工单的内容<br>3. 尝试修改现有沟通工单的内容 | 1. 系统阻止修改工单<br>2. 显示提示信息 | 高 |
## 7. 工单关联关系测试

NOTICE： 第一阶段不考虑多用户权限，先默认一个人可以操作所有环节简化权限逻辑

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| REL-001 | 工单与报销单关联 | 1. 创建报销单<br>2. 在报销单show页面创建审核工单<br>3. 在报销单show页面创建沟通工单 | 1. 所有工单都正确关联到报销单<br>2. 报销单可以访问到所有关联工单 | 高 |
| REL-002 | 一个报销单多个工单 | 1. 为同一报销单创建多个审核工单<br>2. 为同一报销单创建多个沟通工单 | 1. 所有工单都关联到同一报销单<br>2. 报销单详情页显示所有关联工单 | 高 |
| REL-003 | 工单与费用明细关联 | 1. 创建报销单和费用明细<br>2. 创建审核工单并选择多个费用明细<br>3. 创建沟通工单并选择部分相同费用明细 | 1. 工单成功关联到选中的费用明细<br>2. 费用明细可以关联到多个工单<br>3. 费用明细详情页显示所有关联工单 | 高 |
| REL-004 | 报销单状态与费用明细状态联动 | 1. 创建报销单和多个费用明细<br>2. 处理部分费用明细至verified状态<br>3. 处理剩余费用明细至verified状态<br>4. 用户点击"处理完成"按钮 | 1. 部分费用明细verified时报销单状态为processing<br>2. 所有费用明细verified，并在用户点击"处理完成"按钮后，报销单状态变为 `close` | 高 |
| REL-005 | 删除报销单对工单的影响 | 1. 创建报销单和关联工单<br>2. 删除报销单 | 1. 关联工单也被删除或标记为无效<br>2. 系统处理级联删除 | 低 |
| REL-006 | 工单创建入口限制 | 1. 尝试在报销单show页面外创建审核工单<br>2. 尝试在报销单show页面外创建沟通工单 | 1. 系统阻止在报销单show页面外创建工单<br>2. 显示错误消息或重定向到报销单列表 | 中 |
| REL-007 | 工单之间无关联关系验证 | 1. 为同一报销单创建审核工单A和沟通工单B<br>2. 修改审核工单A的状态<br>3. 删除审核工单A | 1. 修改审核工单A状态不影响沟通工单B<br>2. 删除审核工单A后沟通工单B仍然存在且状态不变<br>3. 系统中不存在工单之间的直接关联 | 中 |
| REL-008 | 报销单 `close` 状态触发 | 1. 创建报销单和多个费用明细<br>2. 通过工单处理将所有费用明细设为verified<br>3. 用户点击"处理完成"按钮 | 1. 在点击"处理完成"按钮前，即使所有费用明细已verified，报销单状态仍为 processing (或 pending 如果没有工单创建)<br>2. 点击"处理完成"按钮后，报销单状态变为 `close` | 高 |
| REL-009 | 报销单 `close`状态下工单操作限制 | 1. 报销单进入 `close` 状态<br>2. 尝试创建新的审核/沟通工单<br>3. 尝试修改已有的审核/沟通工单 | 1. 新工单无法创建<br>2. 已有工单无法修改 | 高 |
## 8. 费用明细验证测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| FEE-001 | 选择费用明细关联到工单 | 1. 在报销单show页面创建审核工单<br>2. 选择多个费用明细关联到审核工单 | 1. 成功创建费用明细选择记录<br>2. 工单关联到所有选中的费用明细<br>3. 费用明细验证状态为pending | 高 |
| FEE-002 | 批量全选关联费用明细 | 1. 导入报销单<br>2. 导入费用明细<br>3. 在报销单show页面创建审核工单 | 1. 批量全选关联所有相关费用明细<br>2. 费用明细验证状态为pending | 中 |
| FEE-003 | 工单状态变更影响费用明细状态 | 1. 创建审核工单并关联费用明细，保存为pending状态<br>2. 将工单状态变更为processing并保存<br>3. 创建另一个工单， 处理意见：审核通过（工单状态：approved） | 1. 关联到pending状态工单的费用明细状态变为problematic<br>2. 关联到processing状态工单的费用明细状态仍为problematic<br>3. 关联到approved状态工单的费用明细状态变为verified | 高 |
| FEE-004 | 费用明细关联多个工单 | 1. 创建审核工单并关联费用明细<br>2. 创建沟通工单并关联相同费用明细<br>3. 处理两个工单至不同状态 | 1. 费用明细成功关联到两个工单<br>2. 费用明细状态跟随最新处理的工单状态变化 | 高 |
| FEE-005 | 费用明细查看关联工单 | 1. 创建多个工单并关联同一费用明细<br>2. 查看费用明细详情 | 1. 费用明细详情页显示所有关联工单<br>2. 显示每个工单的问题类型和备注说明 | 高 |
| FEE-006 | 费用明细状态对报销单 `close` 状态的影响 | 1. 创建报销单和多个费用明细<br>2. 处理所有费用明细至verified状态<br>3. 用户点击"处理完成"按钮 | 1. 所有费用明细verified是"处理完成"按钮可用的前提条件之一（可能）<br>2. 用户点击"处理完成"后，报销单状态变为 `close` | 高 |
| FEE-007 | 费用明细验证结果记录 | 1. 创建审核工单并关联费用明细<br>2. 添加验证结果说明: 填写工单备注，或者不填写<br>3. 更新工单状态 | 1. 成功记录验证结果说明于工单内<br>2. 费用明细验证状态更新 | 中 |
| FEE-008 | 费用明细问题标记 | 1. 创建审核工单并关联费用明细<br>2. 标记费用明细存在问题<br>3. 选择问题类型和添加说明 | 1. 费用明细验证状态更新为problematic<br>2. 成功记录问题类型和说明于工单内<br>3. 费用明细详情页显示问题信息 | 高 |
| FEE-009 | 多工单状态冲突处理 | 1. 创建审核工单A（processing）关联费用X<br>2. 创建沟通工单B（approved）关联相同费用X | 1. 费用X最终状态应为verified (基于工单B的处理结果)<br>2. 显示工单B为最终有效状态的工单 | 高 |
| FEE-010 | 费用明细受工单影响记录查看 | 1. 对同一费用明细执行3次不同工单操作（例如，工单1设为problematic，工单2设为problematic，工单3设为verified）<br>2. 查看费用明细关联的工单列表或活动记录 | 1. 能查看到影响该费用明细的各工单信息<br>2. 能确定费用明细的最终状态是如何形成的（例如，基于最新的有效工单操作） | 中 |
## 9. 集成测试场景

NOTICE：第一阶段暂时假设只有一个admin user，简化权限用户测试

| 测试ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| INT-001 | 完整报销流程-快递收单到审核完成 | 1. 导入报销单<br>2. 导入快递收单<br>3. 在报销单show页面创建审核工单<br>4. 处理审核工单至approved状态<br>5. 用户点击"处理完成"按钮使报销单close | 1. 快递收单工单自动创建并完成<br>2. 审核工单状态正确处理（如标记为approved）<br>3. 费用明细状态从pending变为verified<br>4. 报销单状态：pending -> processing (因创建工单) -> close (因点击按钮) | 高 |
| INT-002 | 完整报销流程-包含沟通处理 | 1. 导入报销单<br>2. 导入快递收单<br>3. 在报销单show页面创建审核工单<br>4. 处理审核工单至rejected状态<br>5. 创建沟通工单<br>6. 处理沟通工单至approved状态<br>7. 用户点击"处理完成"按钮使报销单close | 1. 所有工单状态正确处理<br>2. 费用明细状态先变为problematic后变为verified<br>3. 报销单状态：pending -> processing (因创建工单) -> close (因点击按钮) | 高 |
|         |                                 |                                                              |                                                              |        |
| INT-004 | 费用明细多工单关联测试 | 1. 导入报销单和费用明细<br>2. 创建审核工单并关联费用明细<br>3. 创建沟通工单并关联相同费用明细<br>4. 处理两个工单至不同状态 | 1. 费用明细成功关联到多个工单<br>2. 费用明细状态跟随最新有效处理的工单状态变化<br>3. 费用明细详情页显示所有关联工单信息 | 高 |
| INT-005 | 操作历史影响报销单状态 | 1. 导入报销单<br>2. 创建并处理工单 (报销单状态变为 processing)<br>3. 导入包含审批通过的操作历史数据 | 1. 报销单状态更新为 `close` (基于操作历史导入)<br>2. 工单状态不受影响 | 中 |
| INT-006 | 电子发票标志测试 | 1. 导入报销单<br>2. 设置电子发票标志<br>3. 观察系统行为 | 1. 电子发票标志成功设置<br> 2. 在list 或者show界面，显示发票是电子发票 | 中 |
| INT-007 | 多个报销单并行处理 | 1. 导入多个报销单<br>2. 并行处理多个工单<br>3. 观察系统行为 | 1. 各报销单处理互不影响<br>2. 所有工单状态正确处理，报销单状态正确流转 | 低 |
| INT-008 | 直接通过工单测试 | 1. 导入报销单和费用明细<br>2. 创建工单并直接设置为approved状态<br>3. 观察费用明细状态变化 | 1. 工单状态直接设置为approved<br>2. 费用明细状态直接变为verified<br>3. 报销单状态变为 processing | 高 |
| INT-009 | 报销单关闭后工单操作限制测试 | 1. 导入报销单、快递单、费用明细<br>2. 创建审核/沟通工单 (报销单变为 processing)<br>3. 用户点击"处理完成"按钮使报销单变为 close<br>4. 尝试创建新的审核/沟通工单<br>5. 尝试修改已存在的审核/沟通工单 | 1. 新工单无法创建<br>2. 已有工单无法修改<br>3. 报销单保持 close 状态 | 高 |
## 10. 测试执行计划

测试执行计划将按照系统实施路线图分为四个主要阶段进行：

### 10.1 数据结构调整阶段测试（5月1日 - 5月4日）

| 测试活动 | 测试内容 | 时间安排 | 负责人 |
|---------|---------|---------|--------|
| 数据库迁移设计评审 | 评审数据库迁移脚本，确保符合设计要求 | 5月2日 | 测试负责人 |
| 数据库迁移测试 | 验证数据库迁移执行成功，表结构符合预期 | 5月4日 | 测试负责人 |
| 数据完整性测试 | 验证迁移后数据的完整性和一致性 | 5月4日 | 测试负责人 |

### 10.2 模型实现阶段测试（5月5日 - 5月12日）

| 测试活动 | 测试内容 | 时间安排 | 负责人 |
|---------|---------|---------|--------|
| 工单基类单元测试 | 测试WorkOrder基类的功能和方法 | 5月7日 | 测试负责人 |
| 审核工单单元测试 | 测试AuditWorkOrder的功能和与费用明细的联动 | 5月9日 | 测试负责人 |
| 沟通工单单元测试 | 测试CommunicationWorkOrder的功能（包括needs_communication标志）和与费用明细的联动 | 5月11日 | 测试负责人 |
| 快递收单工单单元测试 | 测试ExpressReceiptWorkOrder的功能和自动完成逻辑 | 5月12日 | 测试负责人 |

### 10.3 控制器与视图阶段测试（5月13日 - 5月23日）

| 测试活动 | 测试内容 | 时间安排 | 负责人 |
|---------|---------|---------|--------|
| 工单基础控制器测试 | 测试工单基础控制器的CRUD功能（考虑报销单close状态下的限制） | 5月15日 | 测试负责人 |
| 审核工单控制器与视图测试 | 测试审核工单的特定功能和界面展示 | 5月18日 | 测试负责人 |
| 沟通工单控制器与视图测试 | 测试沟通工单的特定功能和界面展示 | 5月21日 | 测试负责人 |
| 快递收单工单控制器与视图测试 | 测试快递收单工单的特定功能和界面展示 | 5月23日 | 测试负责人 |
| 报销单状态管理测试 | 测试报销单 pending, processing, close 状态流转及相关逻辑 (如REL-008, WF-CL系列用例) | 5月22日 | 测试负责人 |

### 10.4 测试与部署阶段（5月24日 - 6月1日）

| 测试活动 | 测试内容 | 时间安排 | 负责人 |
|---------|---------|---------|--------|
| 单元测试执行 | 执行所有单元测试，确保各模块功能正常 | 5月24日-26日 | 测试负责人 |
| 集成测试执行 | 执行集成测试，验证模块间交互正常 | 5月27日-29日 | 测试负责人 |
| 用户验收测试 | 执行用户验收测试，验证系统满足业务需求 | 5月30日-31日 | 测试负责人 |
| 部署前测试 | 在生产环境部署前进行最终测试 | 6月1日 | 测试负责人 |
| 表单结构一致性测试 | 执行INT-003测试用例 | 5月29日 | 测试负责人 |
## 11. 测试报告模板

### 11.1 测试报告概述

测试报告将包含以下内容：

1. **测试概述**：测试目标、范围和执行时间
2. **测试环境**：测试环境配置和版本信息
3. **测试结果摘要**：通过/失败测试用例数量和比例
4. **测试详情**：每个测试用例的执行结果和问题描述
5. **问题跟踪**：发现的缺陷及其严重程度和状态
6. **结论与建议**：测试结论和改进建议

### 11.2 缺陷报告模板

| 字段 | 描述 |
|------|------|
| 缺陷ID | 唯一标识符 |
| 缺陷标题 | 简短描述缺陷 |
| 严重程度 | 严重/高/中/低 |
| 优先级 | 高/中/低 |
| 状态 | 新建/已分配/已修复/已验证/已关闭 |
| 报告人 | 发现缺陷的测试人员 |
| 分配给 | 负责修复的开发人员 |
| 报告日期 | 缺陷报告日期 |
| 修复日期 | 缺陷修复日期 |
| 验证日期 | 缺陷验证日期 |
| 重现步骤 | 详细的重现步骤 |
| 预期结果 | 正确的预期行为 |
| 实际结果 | 实际观察到的行为 |
| 附件 | 截图或日志文件 |
| 备注 | 其他相关信息 |