# 1.2 数据库迁移脚本准备

任务：创建数据库迁移脚本。
输入：数据库结构设计文档。
输出：完整的数据库迁移脚本。

### 步骤
1. **创建工单类型表迁移**:
   - 使用 `rails generate migration CreateWorkOrders name:string type:string status:string reimbursement_id:integer created_by:integer` 创建工单类型表。
   - 在 `db/migrate/` 文件夹中找到生成的迁移文件，添加必要的字段。

2. **创建关联表迁移**:
   - 创建 `fee_detail_selections` 表：`rails generate migration CreateFeeDetailSelections fee_detail_id:integer work_order_id:integer work_order_type:string verification_status:string verification_comment:text verified_by:integer verified_at:datetime`.
   - 创建 `communication_records` 表：`rails generate migration CreateCommunicationRecords communication_work_order_id:integer content:text communicator_role:string communicator_name:string communication_method:string recorded_at:datetime`.

3. **设置索引和约束**:
   - 在迁移文件中添加索引：`add_index :fee_detail_selections, :fee_detail_id`.
   - 确保外键约束：`add_foreign_key :fee_detail_selections, :fee_details`.

4. **验证迁移脚本**:
   - 运行 `rails db:migrate` 执行迁移。
   - 使用 `rails db:rollback` 回滚迁移以验证迁移脚本的正确性。

5. **执行迁移**:
   - 确保迁移脚本正确无误后，使用 `rails db:migrate` 执行迁移。

### 验收标准
- 确保迁移脚本正确创建所有必要的表和字段。
- 确认索引和约束设置正确。
- 数据库迁移成功，且数据结构符合设计要求。