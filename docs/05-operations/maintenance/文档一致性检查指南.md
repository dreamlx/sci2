# æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†æ£€æŸ¥å’Œç»´æŠ¤æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§çš„æ–¹æ³•å’Œå·¥å…·ï¼Œç¡®ä¿æ–‡æ¡£å§‹ç»ˆåæ˜ å®é™…çš„ç³»ç»Ÿå®ç°ã€‚

## ğŸ” æ£€æŸ¥ç»´åº¦

### 1. APIæ–‡æ¡£ä¸€è‡´æ€§

#### æ£€æŸ¥å†…å®¹
- è·¯ç”±å®šä¹‰ä¸APIæ–‡æ¡£çš„ä¸€è‡´æ€§
- å‚æ•°ç±»å‹å’Œå¿…å¡«é¡¹
- å“åº”æ ¼å¼å’ŒçŠ¶æ€ç 
- è®¤è¯å’Œæƒé™è¦æ±‚

#### æ£€æŸ¥æ–¹æ³•
```bash
# æå–è·¯ç”±ä¿¡æ¯
rails routes > tmp/current_routes.txt

# å¯¹æ¯”APIæ–‡æ¡£ä¸­çš„è·¯ç”±
grep -r "GET\|POST\|PUT\|DELETE" docs/03-development/api/ > tmp/documented_routes.txt

# äººå·¥å¯¹æ¯”å·®å¼‚
diff tmp/current_routes.txt tmp/documented_routes.txt
```

#### è‡ªåŠ¨åŒ–è„šæœ¬å»ºè®®
```ruby
# scripts/check_api_docs.rb
#!/usr/bin/env ruby

require_relative '../config/environment'

class ApiDocChecker
  def check_routes
    # è·å–å®é™…è·¯ç”±
    actual_routes = Rails.application.routes.routes.map do |route|
      {
        verb: route.verb,
        path: route.path.spec.to_s,
        controller: route.defaults[:controller],
        action: route.defaults[:action]
      }
    end
    
    # æ£€æŸ¥æ–‡æ¡£ä¸­çš„è·¯ç”±
    # å®ç°é€»è¾‘...
  end
  
  def check_parameters
    # æ£€æŸ¥å‚æ•°å®šä¹‰
    # å®ç°é€»è¾‘...
  end
end
```

### 2. æ•°æ®æ¨¡å‹ä¸€è‡´æ€§

#### æ£€æŸ¥å†…å®¹
- æ•°æ®åº“è¡¨ç»“æ„ä¸æ¨¡å‹æ–‡æ¡£
- å­—æ®µç±»å‹ã€çº¦æŸå’Œé»˜è®¤å€¼
- å…³è”å…³ç³»å®šä¹‰
- éªŒè¯è§„åˆ™

#### æ£€æŸ¥æ–¹æ³•
```bash
# ç”Ÿæˆå½“å‰æ•°æ®åº“ç»“æ„
rails db:schema:dump

# å¯¹æ¯”schema.rbä¸æ¨¡å‹æ–‡æ¡£
# æ£€æŸ¥å­—æ®µå®šä¹‰
grep -r "t\." db/schema.rb > tmp/current_schema.txt
```

#### æ¨¡å‹æ–‡æ¡£æ¨¡æ¿
```markdown
# æ¨¡å‹åç§°

## å­—æ®µå®šä¹‰
| å­—æ®µå | ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| id | integer | primary key | - | ä¸»é”® |
| name | string | not null | - | åç§° |

## å…³è”å…³ç³»
- belongs_to :user
- has_many :items

## éªŒè¯è§„åˆ™
- validates :name, presence: true
- validates :email, uniqueness: true

## ä¸šåŠ¡é€»è¾‘
- çŠ¶æ€æœºå®šä¹‰
- å›è°ƒæ–¹æ³•
- ä½œç”¨åŸŸå®šä¹‰
```

### 3. æœåŠ¡ç±»ä¸€è‡´æ€§

#### æ£€æŸ¥å†…å®¹
- æœåŠ¡ç±»çš„å…¬å…±æ–¹æ³•ç­¾å
- å‚æ•°ç±»å‹å’Œè¿”å›å€¼
- å¼‚å¸¸å¤„ç†
- ä¸šåŠ¡é€»è¾‘æµç¨‹

#### æ£€æŸ¥æ–¹æ³•
```bash
# æå–æœåŠ¡ç±»æ–¹æ³•
find app/services -name "*.rb" -exec grep -H "def " {} \; > tmp/service_methods.txt

# æ£€æŸ¥æ–‡æ¡£ä¸­çš„æ–¹æ³•å®šä¹‰
find docs/03-development/services -name "*.md" -exec grep -H "def\|æ–¹æ³•" {} \;
```

### 4. é…ç½®å‚æ•°ä¸€è‡´æ€§

#### æ£€æŸ¥å†…å®¹
- ç¯å¢ƒå˜é‡å®šä¹‰
- é…ç½®æ–‡ä»¶å‚æ•°
- é»˜è®¤å€¼è®¾ç½®
- å‚æ•°è¯´æ˜

#### æ£€æŸ¥æ–¹æ³•
```bash
# æå–ç¯å¢ƒå˜é‡
grep -r "ENV\[" app/ config/ > tmp/env_vars.txt

# æ£€æŸ¥é…ç½®æ–‡æ¡£
grep -r "ENV\|ç¯å¢ƒå˜é‡" docs/04-deployment/ docs/07-reference/
```

## ğŸ› ï¸ æ£€æŸ¥å·¥å…·

### 1. è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

#### ä¸»æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# scripts/doc_consistency_check.sh

echo "=== SCI2 æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥ ==="
echo "å¼€å§‹æ—¶é—´: $(date)"

# 1. æ£€æŸ¥APIæ–‡æ¡£
echo "1. æ£€æŸ¥APIæ–‡æ¡£ä¸€è‡´æ€§..."
ruby scripts/check_api_docs.rb

# 2. æ£€æŸ¥æ•°æ®æ¨¡å‹
echo "2. æ£€æŸ¥æ•°æ®æ¨¡å‹ä¸€è‡´æ€§..."
ruby scripts/check_model_docs.rb

# 3. æ£€æŸ¥æœåŠ¡ç±»
echo "3. æ£€æŸ¥æœåŠ¡ç±»ä¸€è‡´æ€§..."
ruby scripts/check_service_docs.rb

# 4. æ£€æŸ¥é…ç½®æ–‡æ¡£
echo "4. æ£€æŸ¥é…ç½®æ–‡æ¡£ä¸€è‡´æ€§..."
ruby scripts/check_config_docs.rb

# 5. ç”ŸæˆæŠ¥å‘Š
echo "5. ç”Ÿæˆä¸€è‡´æ€§æŠ¥å‘Š..."
ruby scripts/generate_consistency_report.rb

echo "æ£€æŸ¥å®Œæˆæ—¶é—´: $(date)"
```

### 2. æŒç»­é›†æˆæ£€æŸ¥

#### GitHub Actionsé…ç½®
```yaml
# .github/workflows/doc_consistency.yml
name: Documentation Consistency Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  doc-consistency:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 3.0
        
    - name: Install dependencies
      run: bundle install
      
    - name: Check documentation consistency
      run: |
        chmod +x scripts/doc_consistency_check.sh
        ./scripts/doc_consistency_check.sh
        
    - name: Upload consistency report
      uses: actions/upload-artifact@v2
      with:
        name: consistency-report
        path: tmp/consistency_report.html
```

### 3. å¼€å‘ç¯å¢ƒé›†æˆ

#### Git Hooks
```bash
#!/bin/bash
# .git/hooks/pre-commit

# æ£€æŸ¥æ˜¯å¦æœ‰æ¨¡å‹æ–‡ä»¶å˜æ›´
if git diff --cached --name-only | grep -q "app/models/\|db/migrate/"; then
    echo "æ£€æµ‹åˆ°æ¨¡å‹å˜æ›´ï¼Œæ£€æŸ¥æ–‡æ¡£ä¸€è‡´æ€§..."
    ruby scripts/check_model_docs.rb --quick
    if [ $? -ne 0 ]; then
        echo "æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œè¯·æ›´æ–°ç›¸å…³æ–‡æ¡£"
        exit 1
    fi
fi
```

## ğŸ“Š ä¸€è‡´æ€§æŠ¥å‘Š

### æŠ¥å‘Šæ ¼å¼

#### HTMLæŠ¥å‘Šæ¨¡æ¿
```html
<!DOCTYPE html>
<html>
<head>
    <title>SCI2 æ–‡æ¡£ä¸€è‡´æ€§æŠ¥å‘Š</title>
    <style>
        .pass { color: green; }
        .fail { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š</h1>
    <p>ç”Ÿæˆæ—¶é—´: {{timestamp}}</p>
    
    <h2>æ€»ä½“ç»Ÿè®¡</h2>
    <ul>
        <li>æ£€æŸ¥é¡¹ç›®: {{total_checks}}</li>
        <li class="pass">é€šè¿‡: {{passed_checks}}</li>
        <li class="fail">å¤±è´¥: {{failed_checks}}</li>
        <li class="warning">è­¦å‘Š: {{warning_checks}}</li>
    </ul>
    
    <h2>è¯¦ç»†ç»“æœ</h2>
    {{detailed_results}}
</body>
</html>
```

#### MarkdownæŠ¥å‘Šæ¨¡æ¿
```markdown
# æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: {{timestamp}}  
**æ£€æŸ¥ç‰ˆæœ¬**: {{git_commit}}

## ğŸ“Š æ€»ä½“ç»Ÿè®¡

| æ£€æŸ¥ç±»å‹ | æ€»æ•° | é€šè¿‡ | å¤±è´¥ | è­¦å‘Š |
|---------|------|------|------|------|
| APIæ–‡æ¡£ | {{api_total}} | {{api_pass}} | {{api_fail}} | {{api_warn}} |
| æ•°æ®æ¨¡å‹ | {{model_total}} | {{model_pass}} | {{model_fail}} | {{model_warn}} |
| æœåŠ¡ç±» | {{service_total}} | {{service_pass}} | {{service_fail}} | {{service_warn}} |
| é…ç½®å‚æ•° | {{config_total}} | {{config_pass}} | {{config_fail}} | {{config_warn}} |

## ğŸ” è¯¦ç»†ç»“æœ

### APIæ–‡æ¡£æ£€æŸ¥
{{api_details}}

### æ•°æ®æ¨¡å‹æ£€æŸ¥
{{model_details}}

### æœåŠ¡ç±»æ£€æŸ¥
{{service_details}}

### é…ç½®å‚æ•°æ£€æŸ¥
{{config_details}}

## ğŸ“‹ å¾…ä¿®å¤é—®é¢˜

### é«˜ä¼˜å…ˆçº§
{{high_priority_issues}}

### ä¸­ä¼˜å…ˆçº§
{{medium_priority_issues}}

### ä½ä¼˜å…ˆçº§
{{low_priority_issues}}
```

## ğŸ”„ ç»´æŠ¤æµç¨‹

### æ—¥å¸¸ç»´æŠ¤

#### 1. ä»£ç å˜æ›´æ—¶
```bash
# å¼€å‘è€…åœ¨æäº¤ä»£ç å‰è¿è¡Œ
./scripts/doc_consistency_check.sh --quick

# å¦‚æœå‘ç°ä¸ä¸€è‡´ï¼Œæ›´æ–°ç›¸å…³æ–‡æ¡£
# ç„¶åé‡æ–°æ£€æŸ¥
./scripts/doc_consistency_check.sh --verify-fix
```

#### 2. åŠŸèƒ½å‘å¸ƒå‰
```bash
# å®Œæ•´çš„ä¸€è‡´æ€§æ£€æŸ¥
./scripts/doc_consistency_check.sh --full

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
./scripts/generate_consistency_report.rb --detailed --output=tmp/release_doc_report.html
```

### å®šæœŸç»´æŠ¤

#### æ¯å‘¨æ£€æŸ¥
- è¿è¡Œå®Œæ•´çš„ä¸€è‡´æ€§æ£€æŸ¥
- å®¡æŸ¥æ–°å¢çš„ä¸ä¸€è‡´é—®é¢˜
- æ›´æ–°æ–‡æ¡£å€ºåŠ¡æ¸…å•

#### æ¯æœˆå®¡æŸ¥
- åˆ†æä¸€è‡´æ€§è¶‹åŠ¿
- è¯„ä¼°æ–‡æ¡£è´¨é‡æŒ‡æ ‡
- ä¼˜åŒ–æ£€æŸ¥å·¥å…·å’Œæµç¨‹

#### æ¯å­£åº¦è¯„ä¼°
- å…¨é¢å®¡æŸ¥æ–‡æ¡£ç»“æ„
- è¯„ä¼°ç”¨æˆ·åé¦ˆ
- è°ƒæ•´æ–‡æ¡£ç­–ç•¥

## ğŸ¯ è´¨é‡æŒ‡æ ‡

### ä¸€è‡´æ€§æŒ‡æ ‡
- **APIä¸€è‡´æ€§**: ç›®æ ‡ â‰¥95%
- **æ¨¡å‹ä¸€è‡´æ€§**: ç›®æ ‡ â‰¥98%
- **é…ç½®ä¸€è‡´æ€§**: ç›®æ ‡ â‰¥90%
- **æ•´ä½“ä¸€è‡´æ€§**: ç›®æ ‡ â‰¥95%

### å“åº”æ—¶é—´æŒ‡æ ‡
- **é—®é¢˜å‘ç°**: â‰¤1å¤©
- **é—®é¢˜ä¿®å¤**: â‰¤3å¤©
- **æ–‡æ¡£æ›´æ–°**: â‰¤1å¤©

### è¦†ç›–ç‡æŒ‡æ ‡
- **APIè¦†ç›–ç‡**: â‰¥90%
- **æ¨¡å‹è¦†ç›–ç‡**: â‰¥95%
- **æœåŠ¡è¦†ç›–ç‡**: â‰¥85%

## ğŸš¨ å‘Šè­¦æœºåˆ¶

### å‘Šè­¦çº§åˆ«

#### ä¸¥é‡ (Critical)
- æ ¸å¿ƒAPIæ–‡æ¡£ä¸å®ç°ä¸ç¬¦
- æ•°æ®åº“ç»“æ„é‡å¤§å˜æ›´æœªæ›´æ–°æ–‡æ¡£
- éƒ¨ç½²é…ç½®é”™è¯¯

#### è­¦å‘Š (Warning)
- æ–°å¢APIæœªæ·»åŠ æ–‡æ¡£
- æ¨¡å‹å­—æ®µå˜æ›´æœªæ›´æ–°è¯´æ˜
- é…ç½®å‚æ•°ç¼ºå°‘è¯´æ˜

#### ä¿¡æ¯ (Info)
- æ–‡æ¡£æ ¼å¼ä¸è§„èŒƒ
- é“¾æ¥å¤±æ•ˆ
- ç¤ºä¾‹ä»£ç è¿‡æ—¶

### é€šçŸ¥æ–¹å¼
- **Slacké€šçŸ¥**: å®æ—¶å‘Šè­¦
- **é‚®ä»¶æŠ¥å‘Š**: æ¯æ—¥/æ¯å‘¨æ±‡æ€»
- **GitHub Issue**: è‡ªåŠ¨åˆ›å»ºä¿®å¤ä»»åŠ¡

## ğŸ“š æœ€ä½³å®è·µ

### æ–‡æ¡£ç¼–å†™
1. **åŒæ­¥æ›´æ–°**: ä»£ç å˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
2. **æ¨¡æ¿ä½¿ç”¨**: ä½¿ç”¨æ ‡å‡†åŒ–çš„æ–‡æ¡£æ¨¡æ¿
3. **äº¤å‰å¼•ç”¨**: å»ºç«‹æ–‡æ¡£é—´çš„å…³è”å…³ç³»
4. **ç‰ˆæœ¬æ ‡è®°**: æ ‡æ˜æ–‡æ¡£çš„é€‚ç”¨ç‰ˆæœ¬

### æ£€æŸ¥æµç¨‹
1. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: å°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–æ£€æŸ¥
2. **äººå·¥å®¡æŸ¥**: å®šæœŸè¿›è¡Œäººå·¥å®¡æŸ¥
3. **æŒç»­æ”¹è¿›**: æ ¹æ®æ£€æŸ¥ç»“æœä¼˜åŒ–æµç¨‹
4. **å›¢é˜Ÿåä½œ**: å»ºç«‹å›¢é˜Ÿæ–‡æ¡£ç»´æŠ¤è´£ä»»åˆ¶

### å·¥å…·ä½¿ç”¨
1. **è„šæœ¬ç»´æŠ¤**: å®šæœŸæ›´æ–°æ£€æŸ¥è„šæœ¬
2. **æŠ¥å‘Šåˆ†æ**: æ·±å…¥åˆ†æä¸€è‡´æ€§æŠ¥å‘Š
3. **æŒ‡æ ‡ç›‘æ§**: æŒç»­ç›‘æ§è´¨é‡æŒ‡æ ‡
4. **åé¦ˆå¾ªç¯**: å»ºç«‹ç”¨æˆ·åé¦ˆæœºåˆ¶

---

> ğŸ’¡ **æç¤º**: æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å›¢é˜Ÿçš„å…±åŒåŠªåŠ›ã€‚å»ºè®®å°†æ£€æŸ¥å·¥å…·é›†æˆåˆ°æ—¥å¸¸å¼€å‘æµç¨‹ä¸­ï¼Œç¡®ä¿æ–‡æ¡£å§‹ç»ˆä¸ä»£ç ä¿æŒåŒæ­¥ã€‚