# SCI2项目文档整理和迁移计划

## 📋 项目概述

本计划旨在将SCI2工单系统的文档重新组织，以支持：
- **二次开发**：为未来的开发者提供清晰的技术文档
- **运维部署**：为运维人员提供完整的部署和维护指南
- **AI Coder理解**：为AI辅助开发提供结构化的技术文档

## 🎯 整理目标

### 主要目标
1. **结构化重组**：按功能和使用场景重新组织文档
2. **消除冗余**：合并重复内容，保留最新版本
3. **填补空白**：识别并补充缺失的关键文档
4. **同步更新**：确保文档与实际代码实现保持一致
5. **建立维护机制**：创建文档持续更新的流程

### 次要目标
1. **提升可读性**：统一文档格式和写作风格
2. **增强导航**：创建清晰的索引和交叉引用
3. **版本管理**：建立文档版本控制机制

## 📁 新目录结构

```
docs/
├── README.md                           # 项目文档总导航
├── 01-getting-started/                 # 快速开始
│   ├── README.md
│   ├── 项目概述.md
│   ├── 快速启动指南.md
│   ├── 环境配置.md
│   └── 数据导入指南.md
├── 02-architecture/                    # 系统架构
│   ├── README.md
│   ├── 系统架构设计.md
│   ├── 数据库设计.md
│   ├── 业务流程图.md
│   └── 技术选型说明.md
├── 03-development/                     # 开发指南
│   ├── README.md
│   ├── api/                           # API文档
│   ├── models/                        # 数据模型文档
│   ├── services/                      # 服务层文档
│   ├── frontend/                      # 前端开发指南
│   ├── testing/                       # 测试指南
│   ├── features/                      # 功能实现文档
│   ├── 开发工作流.md
│   ├── 代码规范.md
│   └── 调试指南.md
├── 04-deployment/                      # 部署运维
│   ├── README.md
│   ├── production/                    # 生产环境
│   ├── staging/                       # 测试环境
│   ├── docker/                        # 容器化部署
│   ├── migration/                     # 数据库迁移
│   ├── 部署检查清单.md
│   ├── 环境变量配置.md
│   └── 故障排除手册.md
├── 05-operations/                      # 运维监控
│   ├── README.md
│   ├── performance/                   # 性能优化
│   ├── monitoring/                    # 监控配置
│   ├── backup/                        # 备份恢复
│   ├── security/                      # 安全配置
│   ├── 性能调优指南.md
│   ├── 监控告警配置.md
│   └── 日常维护手册.md
├── 06-ai-development/                  # AI开发支持
│   ├── README.md
│   ├── templates/                     # 代码模板
│   ├── prompts/                       # AI提示词
│   ├── workflows/                     # 开发工作流
│   ├── AI开发指南.md
│   ├── 代码生成模板.md
│   └── 任务分解示例.md
├── 07-reference/                       # 参考文档
│   ├── README.md
│   ├── 功能特性列表.md
│   ├── 配置参数说明.md
│   ├── 错误代码表.md
│   └── 版本更新日志.md
├── 08-archive/                         # 历史归档
│   └── [保持现有结构，添加索引]
└── 09-data/                           # 数据文件
    ├── README.md
    ├── test-data/                     # 测试数据
    ├── templates/                     # 导入模板
    └── examples/                      # 配置示例
```

## 🔄 文档迁移映射表

### 第一阶段：核心文档迁移

| 现有文档 | 目标位置 | 处理方式 | 优先级 |
|---------|---------|---------|--------|
| `0.文档说明.md` | `README.md` | 重写为总导航 | 高 |
| `document_guide_final.md` | `01-getting-started/项目概述.md` | 整合重写 | 高 |
| `999-SCI2工单系统测试计划_v5.md` | `03-development/testing/测试计划.md` | 直接迁移 | 高 |
| `PRODUCTION_DEPLOYMENT_GUIDE.md` | `04-deployment/production/部署指南.md` | 直接迁移 | 高 |
| `CAPISTRANO_DATABASE_FIX.md` | `04-deployment/production/数据库修复.md` | 直接迁移 | 高 |

### 第二阶段：性能优化文档

| 现有文档 | 目标位置 | 处理方式 | 优先级 |
|---------|---------|---------|--------|
| `sqlite_optimization_*.md` | `05-operations/performance/SQLite优化/` | 分类整理 | 中 |
| `code_level_optimization_*.md` | `05-operations/performance/代码优化/` | 分类整理 | 中 |
| `import_performance_optimization_plan.md` | `05-operations/performance/导入优化.md` | 直接迁移 | 中 |
| `excel_sqlite_import_optimization_plan.md` | `05-operations/performance/Excel导入优化.md` | 直接迁移 | 中 |

### 第三阶段：功能实现文档

| 现有文档 | 目标位置 | 处理方式 | 优先级 |
|---------|---------|---------|--------|
| `reimbursement_notification_feature_*.md` | `03-development/features/通知功能/` | 分类整理 | 中 |
| `attachment_upload_feature_*.md` | `03-development/features/附件上传/` | 分类整理 | 中 |
| `reimbursement_assignment_*.md` | `03-development/features/报销单分配/` | 分类整理 | 中 |
| `fee_detail_*.md` | `03-development/features/费用明细/` | 分类整理 | 中 |

### 第四阶段：AI开发文档

| 现有文档 | 目标位置 | 处理方式 | 优先级 |
|---------|---------|---------|--------|
| `archive/AI_CODE/` | `06-ai-development/templates/` | 重新组织 | 低 |
| `admin_templates/` | `06-ai-development/templates/admin/` | 直接迁移 | 低 |
| `model_templates/` | `06-ai-development/templates/models/` | 直接迁移 | 低 |
| `service_templates/` | `06-ai-development/templates/services/` | 直接迁移 | 低 |

## 🔍 文档与代码一致性检查

### 检查策略

#### 1. 自动化检查工具
```bash
# 创建文档一致性检查脚本
scripts/check_doc_consistency.rb
```

#### 2. 检查维度

| 检查项目 | 检查方法 | 频率 |
|---------|---------|------|
| **API文档** | 对比路由文件与API文档 | 每次发布前 |
| **数据模型** | 对比schema.rb与模型文档 | 每次迁移后 |
| **配置参数** | 对比配置文件与参数文档 | 每次配置变更后 |
| **业务流程** | 对比服务类与流程图 | 每月 |
| **部署步骤** | 对比部署脚本与部署文档 | 每次部署后 |

#### 3. 发现的不一致问题

基于代码分析，发现以下文档与实际实现的差异：

##### 数据模型差异
- **文档描述**：某些文档中提到的字段在实际数据库中不存在
- **实际情况**：`fee_details`表包含`flex_field_*`字段，但文档中未充分说明
- **处理方案**：更新数据模型文档，补充字段说明

##### 服务类差异
- **文档描述**：部分服务类的方法签名与文档不符
- **实际情况**：导入服务类已经过多次优化，包含批量处理功能
- **处理方案**：重新生成API文档，确保方法签名一致

##### 业务流程差异
- **文档描述**：工单状态流转逻辑在文档中描述不完整
- **实际情况**：实现了复杂的STI继承结构和状态机
- **处理方案**：重新绘制业务流程图，反映实际实现

### 一致性维护机制

#### 1. 文档更新触发器
```ruby
# 在模型变更时自动提醒更新文档
class DocumentationReminder
  def self.check_model_changes
    # 检查模型变更并提醒更新文档
  end
end
```

#### 2. 代码注释标准
```ruby
# 要求关键业务逻辑添加文档链接注释
class ReimbursementImportService
  # 文档链接: docs/03-development/services/导入服务.md
  def import(test_spreadsheet = nil)
    # 实现逻辑
  end
end
```

#### 3. 文档版本控制
- 使用Git标签管理文档版本
- 建立文档变更日志
- 定期进行文档审查

## 📅 实施时间表

### 第一周：基础结构建立
- [ ] 创建新目录结构
- [ ] 迁移核心文档（README、部署指南等）
- [ ] 建立文档模板和规范

### 第二周：内容整理
- [ ] 迁移性能优化文档
- [ ] 整理功能实现文档
- [ ] 创建API文档

### 第三周：一致性检查
- [ ] 对比代码与文档
- [ ] 修复发现的不一致问题
- [ ] 补充缺失的文档

### 第四周：完善和验证
- [ ] 创建导航和索引
- [ ] 建立维护机制
- [ ] 用户验收测试

## 🛠️ 处理需求变化与文档不一致的策略

### 1. 建立文档债务跟踪系统

```markdown
# 文档债务清单
## 高优先级
- [ ] 报销单状态流转逻辑文档过时
- [ ] SQLite优化配置与实际不符
- [ ] 导入服务API文档缺失

## 中优先级
- [ ] 工单类型说明不完整
- [ ] 权限控制逻辑变更未更新

## 低优先级
- [ ] 界面截图过时
- [ ] 配置示例需要更新
```

### 2. 实施文档驱动开发(DDD)

```ruby
# 在重要变更前，先更新文档
# 1. 更新设计文档
# 2. 评审设计变更
# 3. 实施代码变更
# 4. 验证文档准确性
```

### 3. 建立定期审查机制

- **每月技术债务审查**：检查文档与代码的一致性
- **每季度架构审查**：更新系统架构文档
- **每次发布前**：验证用户文档的准确性

### 4. 自动化工具支持

```bash
# 创建文档一致性检查工具
#!/bin/bash
# scripts/doc_consistency_check.sh

echo "检查API文档一致性..."
ruby scripts/check_api_docs.rb

echo "检查数据模型文档一致性..."
ruby scripts/check_model_docs.rb

echo "检查配置文档一致性..."
ruby scripts/check_config_docs.rb
```

## 📊 成功指标

### 量化指标
- **文档覆盖率**：≥90%的核心功能有对应文档
- **一致性得分**：≥95%的文档与代码保持一致
- **查找效率**：用户能在3分钟内找到所需文档
- **更新频率**：文档更新滞后不超过1周

### 质量指标
- **可读性**：新开发者能在1天内理解系统架构
- **可操作性**：运维人员能独立完成部署和维护
- **AI友好性**：AI能准确理解并生成相关代码

## 🔧 工具和资源

### 文档工具
- **Markdown编辑器**：Typora、Mark Text
- **图表工具**：Mermaid、Draw.io
- **API文档**：YARD、RDoc

### 自动化工具
- **文档生成**：从代码注释自动生成API文档
- **一致性检查**：定期检查文档与代码的一致性
- **链接检查**：验证文档中的内部链接有效性

### 协作工具
- **版本控制**：Git分支管理文档版本
- **评审流程**：Pull Request审查文档变更
- **通知机制**：Slack/邮件通知文档更新

## 📝 后续维护

### 日常维护
1. **代码变更时**：同步更新相关文档
2. **功能发布时**：验证用户文档准确性
3. **问题反馈时**：及时修正文档错误

### 定期维护
1. **每月**：检查文档链接有效性
2. **每季度**：审查文档结构合理性
3. **每年**：全面评估文档体系效果

### 持续改进
1. **收集反馈**：从用户和开发者收集文档使用反馈
2. **分析指标**：定期分析文档使用数据
3. **优化结构**：根据使用情况调整文档组织方式

---

**注意**：本计划将分阶段实施，确保在整理过程中不影响项目的正常开发和维护工作。