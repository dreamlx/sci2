# SCI2工单系统需求变更历史

本文档记录SCI2工单系统开发过程中的需求变更历史，帮助团队成员了解系统需求的演变过程。

## 1. 初始需求（2025年5月）

1. **问题代码库结构**：
   - 多层级结构：DocumentCategory -> ProblemType -> ProblemDescription
   - 复杂的关联关系，包括ProblemTypeFeeTye, Material等表

2. **工单与费用明细关系**：
   - 工单可以关联多个费用明细
   - 费用明细状态更新逻辑不明确

3. **工单问题添加**：
   - 工单只能关联单个问题类型
   - 审核意见自动生成

## 2. 第一次需求变更（2025年5月底）

1. **问题代码库结构简化**：
   - 简化为两级结构：FeeType -> ProblemType
   - 移除DocumentCategory, ProblemDescription, Material等表
   - 为FeeType和ProblemType添加更多字段

2. **工单与费用明细关系明确化**：
   - 引入"最新工单决定原则"
   - 明确费用明细状态更新规则

3. **工单问题添加增强**：
   - 支持工单关联多个问题类型
   - 创建work_order_problems表

## 3. 最新需求变更（2025年6月初）

1. **费用类型显示方式变更**：
   - 原设计：通过下拉列表选择费用类型
   - 新需求：根据选择的费用明细自动分组显示费用类型标签

2. **问题类型选择方式变更**：
   - 原设计：单选下拉列表
   - 新需求：多选复选框，允许选择多个问题类型

3. **审核意见生成方式变更**：
   - 原设计：根据选择的问题类型自动填充审核意见
   - 新需求：完全由用户手动输入，不再自动填充

## 4. 需求变更影响分析

### 4.1 数据库结构影响

1. **第一次需求变更影响**：
   - 移除了多个表：document_categories, problem_descriptions, materials, problem_type_fee_types等
   - 修改了FeeType和ProblemType表结构
   - 添加了work_order_problems表

2. **最新需求变更影响**：
   - 数据库结构无需变更
   - 主要影响界面交互和业务逻辑

### 4.2 业务逻辑影响

1. **第一次需求变更影响**：
   - 实现"最新工单决定原则"
   - 支持工单关联多个问题类型
   - 简化问题代码库管理

2. **最新需求变更影响**：
   - 修改费用类型显示逻辑
   - 修改问题类型选择逻辑
   - 移除审核意见自动生成逻辑

### 4.3 界面交互影响

1. **第一次需求变更影响**：
   - 简化问题代码库管理界面
   - 调整工单创建和编辑界面

2. **最新需求变更影响**：
   - 费用明细选择后自动显示费用类型标签
   - 问题类型使用复选框多选
   - 审核意见完全由用户手动输入

## 5. 需求变更实施状态

| 需求变更 | 文档更新 | 代码实现 | 测试验证 | 状态 |
|---------|---------|---------|---------|------|
| 问题代码库结构简化 | 已完成 | 已完成 | 已完成 | 已上线 |
| 工单与费用明细关系明确化 | 已完成 | 已完成 | 已完成 | 已上线 |
| 工单问题添加增强 | 已完成 | 已完成 | 已完成 | 已上线 |
| 费用类型显示方式变更 | 已完成 | 进行中 | 待验证 | 开发中 |
| 问题类型选择方式变更 | 已完成 | 进行中 | 待验证 | 开发中 |
| 审核意见生成方式变更 | 已完成 | 进行中 | 待验证 | 开发中 |