# SCI2 工单系统用户故事与交互设计

## 1. 概述

本文档描述了SCI2工单系统的用户故事和交互设计，重点关注三个主要功能：

1. **多用户报销单分配**：管理员分配报销单，审核人员根据分配的报销单创建工单。审核人员也可以帮助其他人操作。分配不是强制性的。
2. **操作记录跟踪**：记录系统中所有操作，包括谁在什么时间做了什么操作。
3. **基本统计功能**：提供工作量、处理效率等基本统计信息。

## 2. 用户角色

系统中有以下主要用户角色：

1. **管理员**：负责系统管理、用户管理和报销单分配。
2. **审核人员**：负责处理报销单，创建和处理工单。
3. **导入操作员**：负责导入报销单、费用明细、快递收单和操作历史数据。

## 3. 用户故事

### 3.1 多用户报销单分配

#### 管理员视角

**用户故事 1**：作为管理员，我希望能够将报销单分配给特定的审核人员，以便明确责任归属，提高工作效率。

**交互流程**：
1. 管理员登录系统，进入报销单列表页面。
2. 管理员可以选择单个报销单，点击"分配"按钮，或者批量选择多个报销单，点击"批量分配"按钮。
3. 系统弹出分配对话框，显示所有审核人员列表。
4. 管理员选择一个审核人员，可以添加分配备注，然后点击"确认"按钮。
5. 系统将报销单分配给选定的审核人员，并记录分配操作。
6. 系统显示分配成功消息，报销单列表中的"处理人"列更新为被分配的审核人员。

**用户故事 2**：作为管理员，我希望能够查看每个审核人员的工作量，以便合理分配工作。

**交互流程**：
1. 管理员登录系统，进入仪表盘页面。
2. 仪表盘显示"工作量统计"面板，列出每个审核人员的分配报销单数量、已处理报销单数量和处理中报销单数量。
3. 管理员可以点击审核人员名称，查看该审核人员的详细工作情况。
4. 系统显示该审核人员的分配报销单列表，包括状态、分配时间等信息。

**用户故事 3**：作为管理员，我希望能够重新分配或取消分配报销单，以便应对人员变动或工作调整。

**交互流程**：
1. 管理员登录系统，进入报销单列表页面。
2. 管理员找到已分配的报销单，点击"重新分配"按钮。
3. 系统弹出重新分配对话框，显示所有审核人员列表，并默认选中当前处理人。
4. 管理员选择一个新的审核人员，可以添加重新分配备注，然后点击"确认"按钮。
5. 系统将报销单重新分配给新的审核人员，并记录重新分配操作。
6. 系统显示重新分配成功消息，报销单列表中的"处理人"列更新为新的审核人员。

#### 审核人员视角

**用户故事 4**：作为审核人员，我希望能够查看分配给我的报销单列表，以便集中处理我的工作。

**交互流程**：
1. 审核人员登录系统，系统默认显示"我的报销单"列表。
2. 列表显示所有分配给当前审核人员的报销单，包括状态、分配时间等信息。
3. 审核人员可以点击报销单，进入详情页面进行处理。
4. 审核人员也可以切换到"所有报销单"视图，查看系统中的所有报销单。

**用户故事 5**：作为审核人员，我希望能够处理分配给我的报销单，创建工单进行审核。

**交互流程**：
1. 审核人员在"我的报销单"列表中选择一个报销单，点击进入详情页面。
2. 在报销单详情页面，审核人员可以查看报销单信息和费用明细。
3. 审核人员点击"创建审核工单"或"创建沟通工单"按钮，进入工单创建页面。
4. 审核人员选择费用明细，添加问题，设置处理意见，然后提交工单。
5. 系统创建工单，并记录操作。
6. 系统返回报销单详情页面，显示新创建的工单。

**用户故事 6**：作为审核人员，我希望能够查看和处理所有报销单，以便在必要时帮助其他人处理工作。

**交互流程**：
1. 审核人员在系统中切换到"所有报销单"视图。
2. 列表显示系统中的所有报销单，包括状态、处理人等信息。
3. 审核人员可以点击任何报销单，进入详情页面。
4. 在报销单详情页面，审核人员可以查看报销单信息和费用明细。
5. 即使报销单已分配给其他人，审核人员仍然可以创建工单进行处理。
6. 系统记录操作，包括谁处理了哪个报销单。

### 3.2 操作记录跟踪

**用户故事 7**：作为管理员，我希望能够查看系统中的所有操作记录，以便监控系统使用情况和审计操作。

**交互流程**：
1. 管理员登录系统，进入"操作记录"页面。
2. 页面显示系统中的所有操作记录，包括操作类型、操作人、操作时间、操作对象等信息。
3. 管理员可以使用过滤器，按操作类型、操作人、时间范围等条件筛选操作记录。
4. 管理员可以点击操作记录，查看详细信息，包括操作前后的状态变化。

**用户故事 8**：作为审核人员，我希望能够查看与我相关的操作记录，以便了解我的工作历史和报销单的处理过程。

**交互流程**：
1. 审核人员登录系统，进入"我的操作记录"页面。
2. 页面显示与当前审核人员相关的操作记录，包括由该审核人员执行的操作和对分配给该审核人员的报销单的操作。
3. 审核人员可以使用过滤器，按操作类型、时间范围等条件筛选操作记录。
4. 审核人员可以点击操作记录，查看详细信息。

**用户故事 9**：作为系统用户，我希望在报销单和工单详情页面能够查看相关的操作历史，以便了解处理过程。

**交互流程**：
1. 用户在报销单详情页面，可以看到"操作历史"面板。
2. 面板显示与该报销单相关的所有操作记录，按时间倒序排列。
3. 用户可以点击操作记录，查看详细信息。
4. 同样，在工单详情页面，用户也可以看到与该工单相关的操作历史。

### 3.3 基本统计功能

**用户故事 10**：作为管理员，我希望能够查看系统的整体统计信息，以便了解系统运行情况和工作效率。

**交互流程**：
1. 管理员登录系统，进入仪表盘页面。
2. 仪表盘显示多个统计面板，包括：
   - 报销单状态分布（饼图）
   - 每日/每周/每月处理的报销单数量（折线图）
   - 平均处理时间（数字指标）
   - 各审核人员的工作量（条形图）
3. 管理员可以调整时间范围，查看不同时期的统计数据。
4. 管理员可以点击图表中的数据点，查看详细信息。

**用户故事 11**：作为审核人员，我希望能够查看我的工作统计信息，以便了解我的工作效率和进度。

**交互流程**：
1. 审核人员登录系统，进入"我的统计"页面。
2. 页面显示与当前审核人员相关的统计信息，包括：
   - 分配给我的报销单数量和状态分布
   - 我处理的报销单数量和状态分布
   - 我的平均处理时间
   - 我创建的工单类型分布
3. 审核人员可以调整时间范围，查看不同时期的统计数据。

**用户故事 12**：作为管理员，我希望能够导出统计报表，以便进行进一步分析或向上级汇报。

**交互流程**：
1. 管理员在统计页面上，点击"导出报表"按钮。
2. 系统弹出导出选项对话框，允许选择导出格式（Excel、CSV、PDF）和导出内容。
3. 管理员选择导出选项，点击"确认"按钮。
4. 系统生成报表文件，并提供下载链接。
5. 管理员下载报表文件，用于进一步分析或汇报。

## 4. 交互设计要点

### 4.1 报销单分配

1. **分配状态显示**：
   - 在报销单列表中，清晰显示每个报销单的分配状态和处理人。
   - 使用不同的颜色或图标，区分未分配、已分配给我、已分配给他人的报销单。

2. **分配操作便捷性**：
   - 提供批量分配功能，允许一次性分配多个报销单。
   - 在报销单详情页面，提供快速分配/重新分配按钮。
   - 分配对话框中，显示审核人员的当前工作量，帮助管理员做出决策。

3. **分配非强制性**：
   - 系统不强制要求报销单必须分配才能处理。
   - 未分配的报销单可以被任何审核人员处理。
   - 已分配的报销单也可以被其他审核人员处理，但系统会记录这种情况。

### 4.2 操作记录

1. **操作记录详细度**：
   - 记录所有关键操作，包括创建、修改、删除、状态变更等。
   - 记录操作的上下文信息，如操作对象、操作前后的状态等。
   - 对于敏感操作（如删除、重要状态变更），记录更详细的信息。

2. **操作记录可访问性**：
   - 在相关对象的详情页面，直接显示操作历史。
   - 提供专门的操作记录查询页面，支持多种过滤和排序方式。
   - 操作记录的详情页面，清晰展示操作前后的状态变化。

3. **操作记录可理解性**：
   - 使用自然语言描述操作，而不是技术术语。
   - 对于状态变更，清晰显示从什么状态变更到什么状态。
   - 对于复杂操作，提供详细的上下文信息。

### 4.3 统计功能

1. **统计数据实时性**：
   - 仪表盘和统计页面的数据应尽可能实时更新。
   - 对于复杂的统计计算，可以考虑定时更新（如每小时更新一次）。
   - 显示数据的最后更新时间，让用户了解数据的时效性。

2. **统计数据可视化**：
   - 使用适当的图表类型，展示不同类型的统计数据。
   - 图表应简洁明了，避免过度设计和不必要的视觉元素。
   - 提供交互式功能，如悬停显示详情、点击下钻等。

3. **统计数据个性化**：
   - 允许用户自定义仪表盘，选择关注的统计指标。
   - 记住用户的过滤和时间范围设置，下次访问时自动应用。
   - 提供"我的统计"视图，专注于与当前用户相关的数据。

## 5. 界面原型

### 5.1 报销单列表页面

```
+----------------------------------------------------------------------+
| SCI2 工单系统                                          用户: 管理员   |
+----------------------------------------------------------------------+
| 仪表盘 | 报销单 | 工单 | 统计 | 操作记录 | 设置                      |
+----------------------------------------------------------------------+
| 报销单列表                                                            |
+----------------------------------------------------------------------+
| 视图: [所有报销单 ▼] | 搜索: [                  ] | + 导入 | 批量操作 ▼ |
+----------------------------------------------------------------------+
| □ | 发票号 | 状态 | 处理人 | 创建时间 | 更新时间 | 操作              |
+----------------------------------------------------------------------+
| □ | INV001 | 处理中 | 张三 | 2025-05-01 | 2025-05-02 | 查看 分配     |
| □ | INV002 | 待处理 | 未分配 | 2025-05-01 | 2025-05-01 | 查看 分配   |
| □ | INV003 | 已关闭 | 李四 | 2025-04-28 | 2025-05-01 | 查看         |
| □ | INV004 | 处理中 | 王五 | 2025-04-27 | 2025-04-30 | 查看 分配     |
+----------------------------------------------------------------------+
| 批量操作: [ 分配给... ▼ ] | 执行                                      |
+----------------------------------------------------------------------+
```

### 5.2 报销单详情页面

```
+----------------------------------------------------------------------+
| SCI2 工单系统                                          用户: 审核人员 |
+----------------------------------------------------------------------+
| 仪表盘 | 报销单 | 工单 | 统计 | 操作记录 | 设置                      |
+----------------------------------------------------------------------+
| 报销单详情: INV001                                                    |
+----------------------------------------------------------------------+
| 基本信息                                                              |
+----------------------------------------------------------------------+
| 发票号: INV001                                                        |
| 状态: 处理中                                                          |
| 处理人: 张三                                                          |
| 创建时间: 2025-05-01                                                  |
| 更新时间: 2025-05-02                                                  |
+----------------------------------------------------------------------+
| 费用明细                                                              |
+----------------------------------------------------------------------+
| □ | 明细ID | 费用类型 | 金额 | 状态 | 操作                          |
+----------------------------------------------------------------------+
| □ | FD001 | 交通费 | ¥100.00 | 已验证 | 查看                        |
| □ | FD002 | 餐饮费 | ¥200.00 | 有问题 | 查看                        |
| □ | FD003 | 住宿费 | ¥500.00 | 待验证 | 查看                        |
+----------------------------------------------------------------------+
| 工单                                                                  |
+----------------------------------------------------------------------+
| ID | 类型 | 状态 | 创建人 | 创建时间 | 操作                          |
+----------------------------------------------------------------------+
| WO001 | 审核工单 | 已拒绝 | 张三 | 2025-05-01 | 查看                 |
| WO002 | 沟通工单 | 已通过 | 李四 | 2025-05-02 | 查看                 |
+----------------------------------------------------------------------+
| [ 创建审核工单 ] [ 创建沟通工单 ]                                     |
+----------------------------------------------------------------------+
| 操作历史                                                              |
+----------------------------------------------------------------------+
| 时间 | 操作人 | 操作类型 | 详情                                      |
+----------------------------------------------------------------------+
| 2025-05-02 | 李四 | 创建工单 | 创建了沟通工单 WO002                  |
| 2025-05-01 | 张三 | 创建工单 | 创建了审核工单 WO001                  |
| 2025-05-01 | 管理员 | 分配报销单 | 将报销单分配给张三                |
+----------------------------------------------------------------------+
| 分配信息                                                              |
+----------------------------------------------------------------------+
| 当前处理人: 张三                                                      |
| 分配时间: 2025-05-01                                                  |
| 分配人: 管理员                                                        |
| 备注: 请优先处理                                                      |
| [ 重新分配 ]                                                          |
+----------------------------------------------------------------------+
```

### 5.3 仪表盘页面

```
+----------------------------------------------------------------------+
| SCI2 工单系统                                          用户: 管理员   |
+----------------------------------------------------------------------+
| 仪表盘 | 报销单 | 工单 | 统计 | 操作记录 | 设置                      |
+----------------------------------------------------------------------+
| 仪表盘                                                                |
+----------------------------------------------------------------------+
| 报销单状态分布                | 每日处理报销单数量                    |
+-------------------------------+---------------------------------------+
| [饼图]                        | [折线图]                              |
| 待处理: 10                    |                                       |
| 处理中: 20                    |                                       |
| 已关闭: 50                    |                                       |
+-------------------------------+---------------------------------------+
| 工作量统计                                                            |
+----------------------------------------------------------------------+
| 审核人员 | 分配数量 | 处理中 | 已处理 | 平均处理时间                  |
+----------------------------------------------------------------------+
| 张三 | 15 | 5 | 10 | 2.5天                                           |
| 李四 | 12 | 3 | 9 | 1.8天                                            |
| 王五 | 18 | 8 | 10 | 3.2天                                           |
+----------------------------------------------------------------------+
| 最近操作记录                                                          |
+----------------------------------------------------------------------+
| 时间 | 操作人 | 操作类型 | 详情                                      |
+----------------------------------------------------------------------+
| 2025-05-02 | 李四 | 创建工单 | 创建了沟通工单 WO002                  |
| 2025-05-01 | 张三 | 创建工单 | 创建了审核工单 WO001                  |
| 2025-05-01 | 管理员 | 分配报销单 | 将报销单分配给张三                |
+----------------------------------------------------------------------+
```

## 6. 实现建议

### 6.1 多用户报销单分配

1. **数据模型**：
   - 创建 `reimbursement_assignments` 表，记录报销单分配信息。
   - 表字段包括：报销单ID、被分配人ID、分配人ID、是否活跃、备注、创建时间等。
   - 一个报销单可以有多个分配记录，但只有一个活跃的分配记录。

2. **服务层**：
   - 实现 `ReimbursementAssignmentService`，处理分配、取消分配、重新分配等操作。
   - 实现 `ReimbursementQueryService`，提供各种查询方法，如"我的报销单"、"未分配的报销单"等。

3. **UI实现**：
   - 在报销单列表页面，添加分配状态和处理人列。
   - 实现分配对话框，支持单个和批量分配。
   - 在报销单详情页面，添加分配信息面板和重新分配按钮。
   - 实现"我的报销单"和"所有报销单"视图切换。

### 6.2 操作记录跟踪

1. **数据模型**：
   - 创建 `work_order_operations` 表，记录所有操作。
   - 表字段包括：工单ID、操作人ID、操作类型、操作详情、操作前状态、操作后状态、创建时间等。
   - 操作类型包括：创建工单、更新工单、状态变更、添加问题、移除问题、修改问题等。

2. **服务层**：
   - 实现 `WorkOrderOperationService`，记录各类操作。
   - 在现有服务中集成操作记录功能，如在 `WorkOrderService` 和 `WorkOrderProblemService` 中添加操作记录。

3. **UI实现**：
   - 实现操作记录列表页面，支持多种过滤和排序。
   - 在报销单和工单详情页面，添加操作历史面板。
   - 实现操作记录详情页面，显示操作前后的状态变化。

### 6.3 基本统计功能

1. **数据模型**：
   - 可以直接基于现有数据模型进行统计，不需要额外的表。
   - 对于复杂或高频的统计，可以考虑创建统计缓存表。

2. **服务层**：
   - 实现 `StatisticsService`，提供各种统计方法。
   - 统计方法包括：报销单状态分布、处理数量趋势、平均处理时间、工作量分布等。

3. **UI实现**：
   - 实现仪表盘页面，显示多个统计面板。
   - 使用适当的图表库（如Chart.js、Highcharts等）实现数据可视化。
   - 实现"我的统计"页面，显示与当前用户相关的统计信息。
   - 实现统计报表导出功能。

## 7. 总结

本文档描述了SCI2工单系统的用户故事和交互设计，重点关注多用户报销单分配、操作记录跟踪和基本统计功能。这些功能将支持多个审核人员协同工作，增强系统的审计能力和可追溯性，提高工作效率和透明度。

实现这些功能需要添加新的数据模型、服务和UI组件，但不需要修改现有的核心业务逻辑。建议按照实施计划分阶段实施，优先实现核心功能，并注意性能和用户体验。